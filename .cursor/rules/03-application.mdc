---
alwaysApply: true
---

# Application Layer ê·œì¹™

## ìœ„ì¹˜
`core/application/`

## ì €ì¥ì†Œ êµ¬ì¡°

```
core/application/
â””â”€â”€ order/
    â”œâ”€â”€ usecase/
    â”‚   â”œâ”€â”€ CreateOrderUseCase.java
    â”‚   â””â”€â”€ CancelOrderUseCase.java
    â”œâ”€â”€ command/
    â”‚   â”œâ”€â”€ CreateOrderCommand.java
    â”‚   â””â”€â”€ CancelOrderCommand.java
    â”œâ”€â”€ query/
    â”‚   â””â”€â”€ GetOrderQuery.java
    â””â”€â”€ support/                         # ì„ íƒ ì‚¬í•­
        â””â”€â”€ OrderRetriever.java
```

**ì¤‘ìš”:**
- **ëª¨ë“  PortëŠ” Domain Layerì˜ required/ì— ìœ„ì¹˜** 
  - `core/domain/order/required/OrderStore.java` (ì˜ì†ì„± ì“°ê¸°)
  - `core/domain/order/required/OrderReader.java` (ì˜ì†ì„± ì½ê¸°)
  - `core/domain/order/required/EmailSender.java` (ì´ë©”ì¼)
  - `core/domain/order/required/EventPublisher.java` (ì´ë²¤íŠ¸)
- UseCaseëŠ” Domainì˜ Portë§Œ ì˜ì¡´

## ì±…ì„
- Use Case ì‹¤í–‰ ë° íë¦„ ì¡°ì •
- Domain ë¡œì§ í˜¸ì¶œ (ì§ì ‘ êµ¬í˜„ ê¸ˆì§€)
- íŠ¸ëœì­ì…˜ ê´€ë¦¬

## ë°˜ë“œì‹œ í•´ì•¼ í•  ê²ƒ
1. UseCaseë³„ íŒŒì¼ ë¶„ë¦¬ (1 UseCase = 1 execute())
2. Domainì˜ required/ Portë§Œ ì˜ì¡´ (Store, Reader, ê¸°íƒ€ Port)
3. Command/Queryë¡œ ì…ë ¥ ë°›ê¸°
4. Domain ë¡œì§ í˜¸ì¶œë§Œ (ì§ì ‘ êµ¬í˜„ ê¸ˆì§€)

## ì ˆëŒ€ í•˜ì§€ ë§ ê²ƒ
1. ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ ì§ì ‘ êµ¬í˜„ ê¸ˆì§€
2. JPA, Infrastructure ì§ì ‘ ì˜ì¡´ ê¸ˆì§€
3. Port ì¸í„°í˜ì´ìŠ¤ë¥¼ Applicationì— ì •ì˜í•˜ì§€ ë§ ê²ƒ (Domain required/ì— ìœ„ì¹˜)

---

## íŠ¸ëœì­ì…˜ ì „ëµ

### ì›ì¹™ 1: ê¸°ë³¸ - Repository Adapterì— @Transactional

**ì ìš© ì¡°ê±´:**
- ë‹¨ì¼ Aggregateë§Œ ìˆ˜ì •
- ê°€ì¥ ì¼ë°˜ì ì¸ íŒ¨í„´

**ì˜ˆì‹œ:**
```java
// Infrastructure - Repository Adapter
@Repository
@RequiredArgsConstructor
public class OrderRepositoryAdapter implements OrderRepository {
    
    private final OrderJpaRepository jpaRepository;
    
    @Transactional  // â­ Adapterì—ì„œ íŠ¸ëœì­ì…˜
    @Override
    public Order save(Order order) {
        OrderJpaEntity entity = OrderJpaEntity.from(order);
        OrderJpaEntity saved = jpaRepository.save(entity);
        return saved.toDomain();
    }
}

// UseCase - íŠ¸ëœì­ì…˜ ì—†ìŒ
@UseCase
@RequiredArgsConstructor
public class CancelOrderUseCase {
    private final OrderRepository orderRepository;
    
    public void execute(CancelOrderCommand command) {
        Order order = orderRepository.findById(command.orderId())
            .orElseThrow();
        
        order.cancel(command.reason());
        orderRepository.save(order);  // ì—¬ê¸°ì„œ ì§§ì€ íŠ¸ëœì­ì…˜
    }
}
```

### ì›ì¹™ 2: ì—¬ëŸ¬ Aggregate ìˆ˜ì • - TransactionTemplate

**ì ìš© ì¡°ê±´:**
- ì—¬ëŸ¬ Aggregateë¥¼ ë™ì‹œì— ìˆ˜ì •
- ì›ìì„±ì´ í•„ìš”í•œ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§

**ì˜ˆì‹œ:**
```java
@UseCase
@RequiredArgsConstructor
public class CreateOrderUseCase {
    
    private final TransactionTemplate transactionTemplate;
    private final OrderRepository orderRepository;
    private final CouponRepository couponRepository;
    
    public Order execute(CreateOrderCommand command) {
        return transactionTemplate.execute(status -> {
            // 1. Coupon ì‚¬ìš©
            Coupon coupon = couponRepository.findById(command.couponId())
                .orElseThrow();
            coupon.use();
            couponRepository.save(coupon);
            
            // 2. Order ìƒì„±
            Order order = Order.create(...);
            return orderRepository.save(order);
        });
    }
}
```

### ì›ì¹™ 3: ì™¸ë¶€ API í˜¸ì¶œ ì‚¬ì´ - TransactionTemplate ë¶„ë¦¬

**ì™¸ë¶€ API í˜¸ì¶œì´ íŠ¸ëœì­ì…˜ ì‚¬ì´ì— ë¼ì–´ìˆëŠ” ê²½ìš°**

```java
@UseCase
@RequiredArgsConstructor
public class ProcessOrderPaymentUseCase implements UseCase<ProcessPaymentCommand> {
    
    private final TransactionTemplate transactionTemplate;
    private final OrderRepository orderRepository;
    private final PaymentGateway paymentGateway;  // ì™¸ë¶€ API
    
    public void execute(ProcessPaymentCommand command) {
        
        // ===== íŠ¸ëœì­ì…˜ 1: ì£¼ë¬¸ ì¡°íšŒ ë° ê²€ì¦ =====
        Order order = transactionTemplate.execute(status -> {
            Order o = orderRepository.findById(command.orderId()).orElseThrow();
            
            if (!o.isPayable()) {
                throw new OrderNotPayableException();
            }
            
            return o;
        });
        
        // ===== ì™¸ë¶€ API (íŠ¸ëœì­ì…˜ ë°–) =====
        PaymentResult payment = paymentGateway.process(order.getId(), order.getTotalAmount());
        
        // ===== íŠ¸ëœì­ì…˜ 2: ê²°ì œ ì™„ë£Œ ì²˜ë¦¬ =====
        transactionTemplate.executeWithoutResult(status -> {
            Order o = orderRepository.findById(order.getId()).orElseThrow();
            o.completePayment(payment);
            orderRepository.save(o);
        });
    }
}
```

**ì‚¬ìš© ì‹œê¸°:**
- âœ… ì™¸ë¶€ API í˜¸ì¶œì´ DB ì‘ì—… ì‚¬ì´ì— ìˆëŠ” ê²½ìš°
- âœ… ì™¸ë¶€ API ì‘ë‹µì„ ë°›ì•„ì„œ DBì— ë°˜ì˜í•´ì•¼ í•˜ëŠ” ê²½ìš°

**íŠ¸ëœì­ì…˜ íë¦„:**
```
TX1: ì£¼ë¬¸ ì¡°íšŒ/ê²€ì¦ (0.01ì´ˆ) â†’ ì»¤ë°‹
  â†“
ì™¸ë¶€ API: ê²°ì œ ì²˜ë¦¬ (3ì´ˆ) - DB ì»¤ë„¥ì…˜ ì ìœ  ì•ˆ í•¨
  â†“
TX2: ì£¼ë¬¸ ì™„ë£Œ ì²˜ë¦¬ (0.01ì´ˆ) â†’ ì»¤ë°‹

ì´ DB ì»¤ë„¥ì…˜ ì ìœ : 0.02ì´ˆ (vs 3.02ì´ˆ)
```

## Use Case í…œí”Œë¦¿

### Command UseCase (ë°˜í™˜ê°’ ìˆìŒ)

```java
// core/application/order/usecase/command/CreateOrderUseCase.java
@UseCase
@RequiredArgsConstructor
public class CreateOrderUseCase implements UseCase<CreateOrderCommand> {
    
    private final OrderRepository orderRepository;
    private final EmailSender emailSender;
    
    @Transactional
    public Order execute(CreateOrderCommand command) {
        
        // Repositoryë¡œ ì¤‘ë³µ ì²´í¬
        boolean exists = orderRepository.existsByOrderNumber(command.orderNumber());
        if (exists) {
            throw new DuplicateOrderNumberException();
        }
        
        // Order ìƒì„±
        Order order = Order.create(
            command.userId(),
            command.items(),
            command.deliveryAddress(),
            command.totalAmount()
        );
        
        // Repositoryë¡œ ì €ì¥
        Order saved = orderRepository.save(order);
        
        // ê¸°ìˆ ì  ìš”êµ¬ì‚¬í•­
        emailSender.sendOrderConfirmation(saved);
        
        return saved;
    }
}
```

### Command UseCase (ë°˜í™˜ê°’ ì—†ìŒ)

```java
// core/application/order/usecase/command/CancelOrderUseCase.java
@UseCase
@RequiredArgsConstructor
public class CancelOrderUseCase implements UseCase<CancelOrderCommand> {
    
    private final OrderRepository orderRepository;
    private final EventPublisher eventPublisher;
    
    @Transactional
    public void execute(CancelOrderCommand command) {
        Order order = orderRepository.findById(command.orderId())
            .orElseThrow();
        
        // ê¶Œí•œ ì²´í¬
        if (!order.isOwnedBy(command.userId())) {
            throw new OrderAccessDeniedException();
        }
        
        order.cancel(command.reason());
        
        orderRepository.save(order);
        
        eventPublisher.publish(OrderCancelledEvent.from(order));
    }
}
```

### Query UseCase

```java
// core/application/order/usecase/query/GetMyOrdersUseCase.java
@UseCase
@RequiredArgsConstructor
public class GetMyOrdersUseCase implements UseCase<GetMyOrdersQuery> {
    
    private final OrderQueryRepository orderQueryRepository;  // ë³µì¡í•œ ì¡°íšŒìš©
    
    @Transactional(readOnly = true)
    public Page<OrderSummary> execute(GetMyOrdersQuery query) {
        Page<Order> orders = orderQueryRepository.findByUserId(
            query.userId(),
            query.pageable()
        );
        
        return orders.map(OrderSummary::from);
    }
}

// Note: OrderQueryRepositoryë„ Domain Layerì— ìœ„ì¹˜
// core/domain/order/OrderQueryRepository.java
public interface OrderQueryRepository {
    Page<Order> findByUserId(Long userId, Pageable pageable);
    Page<Order> search(OrderSearchCondition condition, Pageable pageable);
}
```

## Application Support ê·œì¹™ (ì„ íƒ ì‚¬í•­)

### ìœ„ì¹˜
`core/application/*/support/`

**ì¤‘ìš”: domain/service/ê°€ ì•„ë‹˜!**

### ì±…ì„
- UseCaseì˜ ë°˜ë³µë˜ëŠ” ì¡°íšŒ/ê²€ì¦ ë¡œì§ ì œê±°
- **ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ í¬í•¨ ê¸ˆì§€**
- **íŠ¸ëœì­ì…˜ ê´€ë¦¬ëŠ” UseCaseì—ì„œ**

### ë°˜ë“œì‹œ í•´ì•¼ í•  ê²ƒ
1. ì¡°íšŒ ë° ê²€ì¦ë§Œ ìˆ˜í–‰
2. Store/Reader ì˜ì¡´ ê°€ëŠ¥
3. ê°„ë‹¨í•œ í—¬í¼ ë©”ì„œë“œë§Œ

### ì ˆëŒ€ í•˜ì§€ ë§ ê²ƒ
1. **@Transactional ì‚¬ìš© ê¸ˆì§€** (UseCaseì—ì„œ ê´€ë¦¬)
2. **ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ ì‘ì„± ê¸ˆì§€**
3. **ë³µì¡í•œ íë¦„ ì œì–´ ê¸ˆì§€**

### Application Support í…œí”Œë¦¿

#### Retriever (ì¡°íšŒ í—¬í¼) - ê¶Œì¥

```java
// core/application/order/support/OrderRetriever.java
@Component
@RequiredArgsConstructor
public class OrderRetriever {
    
    private final OrderRepository orderRepository;
    
    public Order getOrder(Long orderId) {
        return orderRepository.findByIdWithItems(orderId)
            .orElseThrow(() -> new OrderNotFoundException(orderId));
    }
    
    public Order getOrderWithOwnershipCheck(Long orderId, Long userId) {
        Order order = getOrder(orderId);
        
        if (!order.isOwnedBy(userId)) {
            throw new OrderAccessDeniedException(
                "í•´ë‹¹ ì£¼ë¬¸ì— ì ‘ê·¼í•  ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤"
            );
        }
        
        return order;
    }
}
```

**ì‚¬ìš© ì˜ˆì‹œ:**
```java
@UseCase
@RequiredArgsConstructor
public class CancelOrderUseCase {
    
    private final OrderRetriever orderRetriever;  // âœ… ì¡°íšŒ í—¬í¼
    private final OrderRepository orderRepository;
    
    @Transactional  // âœ… UseCaseì—ì„œ íŠ¸ëœì­ì…˜
    public void execute(CancelOrderCommand command) {
        // Retrieverë¡œ ì¡°íšŒ ë° ê¶Œí•œ ì²´í¬
        Order order = orderRetriever.getOrderWithOwnershipCheck(
            command.orderId(),
            command.userId()
        );
        
        // ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§
        order.cancel(command.reason());
        
        // ì €ì¥
        orderRepository.save(order);
    }
}
```

## Command/Query ì„¤ê³„

### ğŸ“Œ ì„¤ê³„ ì›ì¹™: Domain Model ìš°ì„  ì‚¬ìš© â­

**ê¸°ë³¸ ì›ì¹™:**
> **ê°€ëŠ¥í•˜ë©´ Domain Model ì‚¬ìš©, ì–´ë ¤ìš´ ê²½ìš°ì—ë§Œ Commandìš© DTO ì¶”ê°€**

#### âœ… Domain Model ì§ì ‘ ì‚¬ìš© (ê¶Œì¥):

**ì‚¬ìš© ëŒ€ìƒ:**
- Value Object (Money, Weight, Volume, Contact, Address, LatLng, EntranceInfo ë“±)
- Domain record (OrderItem, Origin, Destination, DeliveryPolicy ë“±)
- ë‹¨ìˆœí•œ ë¹„ì¦ˆë‹ˆìŠ¤ ê³„ì‚° ë©”ì„œë“œë§Œ ìˆëŠ” ê²½ìš° (ì˜ˆ: `getTotalPrice()`)

**ì¥ì :**
- ê²€ì¦ ë¡œì§ì´ Domainì—ë§Œ ì¡´ì¬ (ì¤‘ë³µ ì œê±°)
- UseCaseì—ì„œ ë³€í™˜ ì½”ë“œ ë¶ˆí•„ìš”
- ì½”ë“œ ê°„ê²°ì„± ë° ìœ ì§€ë³´ìˆ˜ ìš©ì´
- Domainì˜ ì˜ì¡´ì„± ë°©í–¥ ëª…í™• (Application â†’ Domain)

**ì˜ˆì‹œ:**
```java
// âœ… ì¢‹ì€ ì˜ˆ - Domain Model ì§ì ‘ ì‚¬ìš©
public record CreateOrderCommand(
    String orderNumber,
    List<OrderItem> items,        // Domain record
    Origin origin,                 // Domain record
    Destination destination,       // Domain record
    DeliveryPolicy deliveryPolicy  // Domain record
) {
    // í•„ìˆ˜ ê°’ ê²€ì¦ë§Œ
}

// UseCaseì—ì„œ ë³€í™˜ ë¶ˆí•„ìš”
public Order execute(CreateOrderCommand command) {
    Order order = Order.create(
        command.orderNumber(),
        command.items(),           // ê·¸ëŒ€ë¡œ ì‚¬ìš©
        command.origin(),          // ê·¸ëŒ€ë¡œ ì‚¬ìš©
        command.destination(),     // ê·¸ëŒ€ë¡œ ì‚¬ìš©
        command.deliveryPolicy()   // ê·¸ëŒ€ë¡œ ì‚¬ìš©
    );
    return orderStore.store(order);
}
```

#### âš ï¸ Command DTO ì¶”ê°€ (í•„ìš”ì‹œë§Œ):

**ì¶”ê°€í•´ì•¼ í•˜ëŠ” ê²½ìš°:**
- Domainê³¼ êµ¬ì¡°ê°€ ì™„ì „íˆ ë‹¤ë¥¸ ê²½ìš°
- API í†µì‹  ìµœì í™”ê°€ í•„ìš”í•œ ê²½ìš° (ëŒ€ëŸ‰ ë°ì´í„° ì „ì†¡ ë“±)
- ë³´ì•ˆìƒ Domainì„ ê·¸ëŒ€ë¡œ ë…¸ì¶œí•˜ë©´ ì•ˆ ë˜ëŠ” ê²½ìš°
- IDê°€ ìˆëŠ” Entityë¥¼ ìƒì„± ìš”ì²­ìœ¼ë¡œ ë°›ì•„ì•¼ í•˜ëŠ” ê²½ìš°

**ì˜ˆì‹œ:**
```java
// âš ï¸ Command DTOê°€ í•„ìš”í•œ ê²½ìš°
public record UpdateOrderCommand(
    Long orderId,
    OrderStatus newStatus,        // Domainì˜ ì¼ë¶€ë§Œ ë³€ê²½
    String changeReason
) {
    // Domainì˜ Order Entityì™€ëŠ” êµ¬ì¡°ê°€ ë‹¤ë¦„
}
```

**ì›ì¹™ ìš”ì•½:**
1. **ë¨¼ì € Domain Model ì‚¬ìš©ì„ ê³ ë ¤** - ëŒ€ë¶€ë¶„ì˜ ê²½ìš° ì¶©ë¶„
2. **ì •ë§ í•„ìš”í•œ ê²½ìš°ì—ë§Œ DTO ì¶”ê°€** - êµ¬ì¡°ê°€ ì™„ì „íˆ ë‹¤ë¥¼ ë•Œ
3. **API Layerì—ì„œ Domain Model ìƒì„±** - Controllerì—ì„œ VO ìƒì„± í›„ Commandì— ì „ë‹¬

---

### Command ê¸°ë³¸ í…œí”Œë¦¿

```java
// core/application/order/usecase/command/CreateOrderCommand.java
@Builder
public record CreateOrderCommand(
    Long userId,
    List<OrderItemCommand> items,
    String deliveryAddress,
    Long couponId
) {
    // ìƒì„± ì‹œì  ê²€ì¦
    public CreateOrderCommand {
        if (userId == null || userId <= 0) {
            throw new IllegalArgumentException("ìœ íš¨í•˜ì§€ ì•Šì€ ì‚¬ìš©ì IDì…ë‹ˆë‹¤");
        }
        
        if (items == null || items.isEmpty()) {
            throw new IllegalArgumentException("ì£¼ë¬¸ ìƒí’ˆì´ ì—†ìŠµë‹ˆë‹¤");
        }
        
        if (deliveryAddress == null || deliveryAddress.isBlank()) {
            throw new IllegalArgumentException("ë°°ì†¡ì§€ê°€ ì—†ìŠµë‹ˆë‹¤");
        }
        
        // ì¤‘ë³µ ìƒí’ˆ ì²´í¬
        long distinctCount = items.stream()
            .map(OrderItemCommand::productId)
            .distinct()
            .count();
        
        if (distinctCount != items.size()) {
            throw new IllegalArgumentException("ì¤‘ë³µëœ ìƒí’ˆì´ ìˆìŠµë‹ˆë‹¤");
        }
    }
    
    public record OrderItemCommand(
        Long productId,
        int quantity
    ) {
        public OrderItemCommand {
            if (productId == null || productId <= 0) {
                throw new IllegalArgumentException("ìœ íš¨í•˜ì§€ ì•Šì€ ìƒí’ˆ IDì…ë‹ˆë‹¤");
            }
            if (quantity < 1 || quantity > 100) {
                throw new IllegalArgumentException("ìˆ˜ëŸ‰ì€ 1~100 ì‚¬ì´ì—¬ì•¼ í•©ë‹ˆë‹¤");
            }
        }
    }
}
```

### ìƒí™©ë³„ ì…ë ¥ê°’ì´ ë‹¤ë¥¸ ê²½ìš°

#### Commandì— Optional í•„ë“œ + íƒ€ì… êµ¬ë¶„

```java
// core/application/order/usecase/command/CancelOrderCommand.java
@Builder
public record CancelOrderCommand(
    // ê³µí†µ í•„ë“œ
    Long orderId,
    String reason,
    
    // íƒ€ì… êµ¬ë¶„
    CancelType cancelType,  // CUSTOMER, ADMIN, SYSTEM
    
    // Optional í•„ë“œ (íƒ€ì…ë³„ë¡œ í•„ìš”)
    Long userId,        // CUSTOMERë§Œ
    String adminMemo,   // ADMINë§Œ
    Long adminId,       // ADMINë§Œ
    String systemCode   // SYSTEMë§Œ
) {
    // íƒ€ì…ë³„ ê²€ì¦
    public CancelOrderCommand {
        if (cancelType == null) {
            throw new IllegalArgumentException("ì·¨ì†Œ íƒ€ì…ì€ í•„ìˆ˜ì…ë‹ˆë‹¤");
        }
        
        switch (cancelType) {
            case CUSTOMER -> {
                if (userId == null) {
                    throw new IllegalArgumentException("ê³ ê° IDëŠ” í•„ìˆ˜ì…ë‹ˆë‹¤");
                }
            }
            case ADMIN -> {
                if (adminId == null || adminMemo == null) {
                    throw new IllegalArgumentException("ê´€ë¦¬ì ì •ë³´ëŠ” í•„ìˆ˜ì…ë‹ˆë‹¤");
                }
            }
            case SYSTEM -> {
                if (systemCode == null) {
                    throw new IllegalArgumentException("ì‹œìŠ¤í…œ ì½”ë“œëŠ” í•„ìˆ˜ì…ë‹ˆë‹¤");
                }
            }
        }
    }
}
```

#### UseCaseì—ì„œ ì§ì ‘ ì²˜ë¦¬

```java
@UseCase
@RequiredArgsConstructor
public class CancelOrderUseCase implements UseCase<CancelOrderCommand> {
    
    private final OrderRetriever orderRetriever;
    private final OrderRepository orderRepository;
    private final PaymentGateway paymentGateway;
    private final EventPublisher eventPublisher;
    
    @Transactional
    public void execute(CancelOrderCommand command) {
        
        // 1. íƒ€ì…ë³„ ì¡°íšŒ
        Order order = retrieveOrder(command);
        
        // 2. íƒ€ì…ë³„ ì·¨ì†Œ ì²˜ë¦¬
        processCancellation(order, command);
        
        // 3. ì €ì¥ ë° ì´ë²¤íŠ¸
        orderRepository.save(order);
        eventPublisher.publish(OrderCancelledEvent.from(order, command.cancelType()));
    }
    
    private Order retrieveOrder(CancelOrderCommand command) {
        return switch (command.cancelType()) {
            case CUSTOMER -> orderRetriever.getOrderWithOwnershipCheck(
                command.orderId(),
                command.userId()
            );
            case ADMIN, SYSTEM -> orderRetriever.getOrder(command.orderId());
        };
    }
    
    private void processCancellation(Order order, CancelOrderCommand command) {
        switch (command.cancelType()) {
            case CUSTOMER -> order.cancel(command.reason());
            case ADMIN -> {
                order.cancelByAdmin(command.reason(), command.adminMemo());
                if (order.isPaid()) {
                    paymentGateway.refund(order.getPaymentId());
                }
            }
            case SYSTEM -> order.cancelBySystem(command.systemCode(), command.reason());
        }
    }
}
```

## UseCaseì—ì„œ Domain Port ì‚¬ìš©

**ì¤‘ìš”:** 
- **ëª¨ë“  PortëŠ” Domain Layerì˜ required/ì— ìœ„ì¹˜**
  - `core/domain/order/required/OrderStore.java`
  - `core/domain/order/required/OrderReader.java`
  - `core/domain/order/required/EmailSender.java`
  - `core/domain/order/required/EventPublisher.java`

### UseCase ì˜ˆì‹œ

```java
@UseCase
@RequiredArgsConstructor
public class CreateOrderUseCase {
    
    // ëª¨ë“  PortëŠ” Domain required/ì—ì„œ ê°€ì ¸ì˜´
    private final OrderStore orderStore;                     // Domain Port
    private final OrderReader orderReader;                   // Domain Port
    private final EmailSender emailSender;                   // Domain Port
    private final EventPublisher eventPublisher;             // Domain Port
    
    @Transactional
    public Order execute(CreateOrderCommand command) {
        // 1. ì¤‘ë³µ ì²´í¬ (Reader)
        boolean exists = orderReader.existsByOrderNumber(command.orderNumber());
        if (exists) {
            throw new DuplicateOrderNumberException();
        }
        
        // 2. Domainìœ¼ë¡œ ì£¼ë¬¸ ìƒì„±
        Order order = Order.create(...);
        
        // 3. Storeë¡œ ì €ì¥
        Order saved = orderStore.save(order);
        
        // 4. Required Port ì‚¬ìš©
        emailSender.sendOrderConfirmation(saved);
        eventPublisher.publish(new OrderCreatedEvent(saved));
        
        return saved;
    }
}
```

### ê·œì¹™
- âœ… ëª¨ë“  PortëŠ” Domain required/ì— ìœ„ì¹˜
- âœ… UseCaseëŠ” Domainì˜ Port(ì¸í„°í˜ì´ìŠ¤)ë§Œ ì˜ì¡´
- âœ… Infrastructureì—ì„œ ëª¨ë“  Portë¥¼ Adapterë¡œ êµ¬í˜„

## ì¤‘ìš” ì›ì¹™

### 1. UseCase ì„¤ê³„
- í•˜ë‚˜ì˜ UseCase = í•˜ë‚˜ì˜ íŒŒì¼ = í•˜ë‚˜ì˜ execute()
- UseCaseëŠ” Port(ì¸í„°í˜ì´ìŠ¤)ë§Œ ì˜ì¡´
- ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì€ Domainì—, UseCaseëŠ” íë¦„ ì œì–´ë§Œ

### 2. íŠ¸ëœì­ì…˜ ì „ëµ
**ê¸°ë³¸: Repository Adapterì— @Transactional**
- ë‹¨ì¼ Aggregate ìˆ˜ì •
- UseCaseëŠ” íŠ¸ëœì­ì…˜ ì—†ìŒ
- ì§§ì€ íŠ¸ëœì­ì…˜

**ì—¬ëŸ¬ Aggregate ìˆ˜ì •: TransactionTemplate**
- ì—¬ëŸ¬ Aggregateë¥¼ í•˜ë‚˜ì˜ íŠ¸ëœì­ì…˜ìœ¼ë¡œ
- UseCaseì—ì„œ ëª…ì‹œì  ì œì–´

**ì™¸ë¶€ API ì‚¬ì´: TransactionTemplate ë¶„ë¦¬**
- íŠ¸ëœì­ì…˜ì„ ì—¬ëŸ¬ ê°œë¡œ ìª¼ê°œê¸°
- DB ì»¤ë„¥ì…˜ ìµœì†Œ ì ìœ 

### 3. Store/Reader ë¶„ë¦¬ (CQRS)
- **OrderStore**: ì“°ê¸° ì‘ì—… (save, delete)
- **OrderReader**: ì½ê¸° ì‘ì—… (find, search, exists)
- íŠ¸ëœì­ì…˜ ìµœì í™” (readOnly = true)

### 4. Support Service
- ì¡°íšŒ/ê²€ì¦ í—¬í¼ë§Œ
- íŠ¸ëœì­ì…˜ ê´€ë¦¬ ê¸ˆì§€
- ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ ê¸ˆì§€
</artifact>

---